<div xmlns="http://www.w3.org/1999/xhtml" lang="en"
     xmlns:f="http://typo3.org/ns/TYPO3/Fluid/ViewHelpers"
     xmlns:flux="http://typo3.org/ns/FluidTYPO3/Flux/ViewHelpers"
     xmlns:v="http://typo3.org/ns/FluidTYPO3/Vhs/ViewHelpers">

    <f:layout name="Content"/>

    <f:section name="Configuration">
        <flux:form id="userStatus" options="{group: 'Common'}" label="User Status (ajax)"
                   description="Permette di inserire lo stato dell'utente e di cambiarlo in modo asincrono">

        </flux:form>
    </f:section>

    <f:section name="Preview">
        <strong>User status Ajax</strong><br/>
    </f:section>

    <f:section name="Main">
        <div class="status-info">
            <h2 class="title">
                {user.username}
                <span id="status-label"
                      class="pull-right label {f:if(condition:'{user.online}',then:'label-success',else:'label-default')}">
                <span id="status-icon"
                      class="glyphicon glyphicon-eye-{f:if(condition:'{user.online}',then:'open',else:'close')}"
                      aria-hidden="true"></span> <span id="status-text">{f:if(condition:'{user.online}',then:'online',else:'offline')}</span>
            </span>
            </h2>

            <button id="toggle-status-button" class="btn
        {f:if(condition:'{user.online}',then:'btn-default',else:'btn-success')}
        btn-xs btn-block">
                <f:if condition="{user.online}">
                    <f:then>
                        <span id="status-button-label">Passa offline</span> <span
                            id="status-button-icon" class="glyphicon glyphicon-eye-close"
                            aria-hidden="true"></span>
                    </f:then>
                    <f:else>
                        <span id="status-button-label">Passa online</span> <span
                            id="status-button-icon" class="glyphicon glyphicon-eye-open"
                            aria-hidden="true"></span>
                    </f:else>
                </f:if>
            </button>

            <script type="text/javascript">

                $(document).ready(function () {

                    $("#toggle-status-button").click(() => {

                        var tsb = $("#toggle-status-button");
                        tsb.button("loading");

                        $.post('/rest/user/status/toggle', (response) => {

                            if (response.status == "ok") {


                                var st = $("#status-text");
                                var sl = $("#status-label");
                                var si = $("#status-icon");
                                var sbi = $("#status-button-icon");
                                var sbl = $("#status-button-label");

                                tsb.button("reset");

                                if (response.data.online) {
                                    st.text("online");
                                    tsb.removeClass("btn-success").addClass("btn-default");
                                    sl.removeClass("label-default").addClass("label-success");
                                    si.removeClass("glyphicon-eye-close").addClass("glyphicon-eye-open");
                                    sbi.removeClass("glyphicon-eye-open").addClass("glyphicon-eye-close");
                                    sbl.text("Passa offline");
                                } else {
                                    st.text("offline");
                                    tsb.removeClass("btn-default").addClass("btn-success");
                                    sl.removeClass("label-success").addClass("label-default");
                                    si.removeClass("glyphicon-eye-open").addClass("glyphicon-eye-close");
                                    sbi.removeClass("glyphicon-eye-close").addClass("glyphicon-eye-open");
                                    sbl.text("Passa online");
                                }
                            }

                        });
                    });

                });
            </script>
        </div>


    </f:section>
</div>
