{namespace csn=Wind\Csnd\ViewHelpers}

<div class="user-post-card" xmlns:f="http://www.w3.org/1999/html">
    <div class="panel panel-default">
        <div class="panel-heading">
            <div class="user-info">
                <img src="{post.user.avatar}" class="avatar img-circle"/>
                <span class="user-name">{post.user.nome} {post.user.cognome}</span>
            </div>
        </div>
        <div class="panel-body">
            <div class="post-info">
                <div class="text">
                    {post.text}
                </div>
            </div>
        </div>

        <div class="panel-footer clearfix">
            <div class="likes-text">
                <f:if condition="{post.likes -> f:count()}>0">
                    <f:then>
                        Piace a
                        <span class="likes-count badge">{post.likes -> f:count()}</span>
                        dipendenti
                    </f:then>
                    <f:else>
                        Ancora nessun like
                    </f:else>
                </f:if>
            </div>
            <f:if condition="{tipo} == 'Content'">
                <f:then>
                    <f:link.action arguments="{postUid: '{post.uid}'}"
                                   controller="Post"
                                   extensionName="csnd"
                                   pluginName="postplugin"
                                   action="like"
                                   class="btn btn-primary pull-right">
                        <csn:likeButtonText post="{post}" then="Non mi piace" else="Mi piace"/>
                    </f:link.action>
                </f:then>
                <f:else>
                    <button class="pull-right btn btn-primary custom-button like-button-{post.uid}">
                        <csn:likeButtonText post="{post}" then="Non mi piace" else="Mi piace"/>
                    </button>
                </f:else>
            </f:if>


            <hr>
            <!-- Aggiunta classe class="comment-form" per poi poter intercettare il form in csdn.js -->
            <f:form
                    class="comment-form"
                    extensionName="csnd"
                    pluginName="postplugin"
                    controller="Comment"
                    action="create"
                    enctype="multipart/form-data"
                    name="newComment"
                    object="{newComment}"
                    arguments="{postUid: post.uid}"
                    additionalAttributes="{data-postuid: post.uid}"
            >

                <label>Scrivi un commento:</label>
                <!-- Aggiunta classe "post-text" per poter poi prelevare il testo della textarea direttamente da csnd.js utilizzando la classe -->
                <f:form.textarea class="form-control post-text-{post.uid}" property="text" rows="3"/>

                <br>

                <f:form.submit value="Commenta" class="btn btn-primary pull-right"/>
            </f:form>


            <hr>

            <label>Commenti presenti:</label>
            <div class="comment-list">
                <f:for each="{post.comments}" as="comment">
                    <f:render partial="UserListItem"
                              arguments="{user: '{comment.user}', comment: comment, postUid: '{post.uid}', loggedUser:user }"></f:render>
                </f:for>
            </div>
            <script type="text/javascript">

                CSND.contentElement.post.like.initLike('{post.uid}');

                /*
                    $(document).ready(function () {
                        var buttonNewComment = $(".button-new-comment");
                        buttonNewComment.click(function () {
                            console.log('click-button-ajax');
                            console.log($(this).serialize());
                        });
                    });
                */

                /*
                    $( 'form[name = "newComment"]' ).on( "submit", function( event ) {
                        event.preventDefault();
                        console.log( $( this ).serialize() );
                    });

                */
            </script>


        </div>
    </div>
</div>