<div xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers" data-namespace-typo3-fluid="true"
     xmlns:v="http://typo3.org/ns/FluidTYPO3/Vhs/ViewHelpers">


    <f:layout name="Default"/>


    <f:section name="main">

        <v:page.header.link rel="stylesheet" href="/fileadmin/templates/css/registrationForm.css"/>

        <div class="registration-form">


            <f:flashMessages/>

            <f:render partial="FormErrors" arguments="{object:User}"/>

            <f:form
                    id="login-form"
                    additionalAttributes="{autocomplete: 'chrome-off'}"
                    action="doLogin"
                    enctype="multipart/form-data" name="newUser"
                    object="{newUser}">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3>Login</h3>
                    </div>
                    <div class="panel-body">
                        <f:render partial="User/LoginFormFields"/>
                    </div>
                    <div class="panel-footer">
                        <f:form.submit class="btn btn-primary" value="Accedi"/>
                    </div>
                </div>
            </f:form>

        </div>
        <script type="text/javascript">

            $(document).ready(function () {

                debugger;
                var loginForm = $("#login-form");

                loginForm.submit(function (e) {

                    e.preventDefault();

                    let username = loginForm.find("input[name='tx_csnd_userplugin[newUser][username]']").val();
                    let password = loginForm.find("input[name='tx_csnd_userplugin[newUser][password]']").val();

                    let data = {
                        username: username,
                        password: password
                    }

                    $.post('/rest/user/login', data, (response) => {

                        if (response) {
                            window.location.href = "/personal/dashboard";
                        }

                    }).fail((error) => {
                        //??
                    })
                });

            });
        </script>
    </f:section>
</div>